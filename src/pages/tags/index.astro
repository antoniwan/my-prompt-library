---
import Layout from "../../layouts/Layout.astro";
import PageHeader from "../../components/PageHeader.astro";
import TagPill from "../../components/TagPill.astro";
import { getPublicPrompts, getTagCounts } from "../../data/prompts";
import { SITE_NAME } from "../../data/site";

const prompts = await getPublicPrompts();
const tags = getTagCounts(prompts);

const siteHref = Astro.site?.href ?? "";
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  name: `Tags — ${SITE_NAME}`,
  description: "Browse prompts by tag. Find prompts by topic and category.",
  url: siteHref ? `${siteHref.replace(/\/$/, "")}/tags/` : undefined,
  ...(siteHref &&
    tags.length > 0 && {
      mainEntity: {
        "@type": "ItemList",
        numberOfItems: tags.length,
        itemListElement: tags.map(({ tag }, i) => ({
          "@type": "ListItem",
          position: i + 1,
          url: `${siteHref.replace(/\/$/, "")}/tags/${encodeURIComponent(tag)}/`,
          name: tag,
        })),
      },
    }),
};
---

<Layout
  title={`Tags — ${SITE_NAME}`}
  description="Browse prompts by tag. Find prompts by topic and category."
  canonicalPath="/tags/"
  structuredData={structuredData}
>
  <PageHeader title="Tags" description="Browse prompts by tag." />

  <ul class="flex list-none flex-wrap gap-2 p-0" aria-label="List of tags">
    {
      tags.map(({ tag, count }) => (
        <li>
          <TagPill tag={tag} count={count} />
        </li>
      ))
    }
  </ul>

  {tags.length === 0 && <p class="text-[var(--color-muted)]">No tags yet.</p>}
</Layout>
