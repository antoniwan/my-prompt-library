---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

const prompts = await getCollection("prompts", ({ data }) => data.visibility === "public");
const tagCounts = new Map<string, number>();
for (const entry of prompts) {
	for (const tag of entry.data.tags) {
		tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
	}
}
const tags = Array.from(tagCounts.entries())
	.sort((a, b) => a[0].localeCompare(b[0]))
	.map(([tag, count]) => ({ tag, count }));
---

<Layout
	title="Tags â€” My Prompt Library"
	description="Browse prompts by tag. Find prompts by topic and category."
>
	<header class="page-header">
		<h1>Tags</h1>
		<p class="lead">Browse prompts by tag.</p>
	</header>

	<ul class="tag-list" aria-label="List of tags">
		{tags.map(({ tag, count }) => (
			<li>
				<a href={`/tags/${encodeURIComponent(tag)}/`} class="tag-link">
					<span class="tag-name">{tag}</span>
					<span class="tag-count" aria-label={`${count} prompt(s)`}>{count}</span>
				</a>
			</li>
		))}
	</ul>

	{tags.length === 0 && <p>No tags yet.</p>}
</Layout>

<style>
	.page-header {
		margin-bottom: 1.5rem;
	}

	.page-header h1 {
		font-size: 1.5rem;
		margin: 0 0 0.5rem;
	}

	.lead {
		color: var(--color-text-muted);
		margin: 0;
		font-size: 0.9375rem;
	}

	.tag-list {
		list-style: none;
		margin: 0;
		padding: 0;
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}

	.tag-link {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		padding: 0.5rem 0.75rem;
		background: var(--color-surface);
		border: 1px solid var(--color-border);
		border-radius: 0.375rem;
		color: inherit;
		text-decoration: none;
	}

	.tag-link:hover,
	.tag-link:focus-visible {
		border-color: var(--color-accent);
		color: var(--color-accent);
		outline: none;
	}

	.tag-name {
		font-weight: 500;
	}

	.tag-count {
		font-size: 0.8125rem;
		color: var(--color-text-muted);
	}
</style>
