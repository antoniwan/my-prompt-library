---
import Layout from "../../layouts/Layout.astro";
import PageHeader from "../../components/PageHeader.astro";
import TagPill from "../../components/TagPill.astro";
import { getCollection } from "astro:content";

const prompts = await getCollection("prompts", ({ data }) => data.visibility === "public");
const tagCounts = new Map<string, number>();
for (const entry of prompts) {
  for (const tag of entry.data.tags) {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  }
}
const tags = Array.from(tagCounts.entries())
  .sort((a, b) => a[0].localeCompare(b[0]))
  .map(([tag, count]) => ({ tag, count }));
---

<Layout
  title="Tags â€” My Prompt Library"
  description="Browse prompts by tag. Find prompts by topic and category."
>
  <PageHeader title="Tags" description="Browse prompts by tag." />

  <ul class="flex list-none flex-wrap gap-2 p-0" aria-label="List of tags">
    {tags.map(({ tag, count }) => (
      <li>
        <TagPill tag={tag} count={count} />
      </li>
    ))}
  </ul>

  {tags.length === 0 && (
    <p class="text-[var(--color-muted)]">No tags yet.</p>
  )}
</Layout>
