---
import Layout from "../../layouts/Layout.astro";
import PageHeader from "../../components/PageHeader.astro";
import PromptCard from "../../components/PromptCard.astro";
import { getPublicPrompts, getUniqueTags } from "../../data/prompts";

export async function getStaticPaths() {
  const prompts = await getPublicPrompts();
  const tagSlugs = getUniqueTags(prompts);
  return tagSlugs.map((tag) => ({
    params: { tag },
    props: { tag },
  }));
}

const { tag } = Astro.props;
const allPrompts = await getPublicPrompts();
const prompts = allPrompts.filter((entry) => entry.data.tags.includes(tag));
---

<Layout title={`${tag} — Tags — My Prompt Library`} description={`Prompts tagged with ${tag}.`}>
  <PageHeader title={`Tag: ${tag}`}>
    <p class="m-0">
      <a href="/tags/" class="text-[var(--color-accent)] hover:underline">All tags</a>
      {" · "}
      {prompts.length} prompt{prompts.length === 1 ? "" : "s"}
    </p>
  </PageHeader>

  <ul class="list-none space-y-4 p-0" aria-label={`Prompts tagged with ${tag}`}>
    {
      prompts.map((entry) => (
        <li>
          <PromptCard entry={entry} showTags={false} />
        </li>
      ))
    }
  </ul>
</Layout>
