---
import Layout from "../layouts/Layout.astro";
import PromptCard from "../components/PromptCard.astro";
import ButtonPrimary from "../components/ButtonPrimary.astro";
import { getPublicPrompts } from "../data/prompts";
import { SITE_NAME, DEFAULT_DESCRIPTION, SITE_AUTHOR } from "../data/site";
import { promptsIndex } from "../utils/urls";

const allPrompts = await getPublicPrompts();
const recentPrompts = allPrompts.slice(0, 5);

const siteHref = Astro.site?.href ?? "";
const structuredData = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: SITE_NAME,
  description: DEFAULT_DESCRIPTION,
  url: siteHref,
  author: { "@type": "Person", name: SITE_AUTHOR.name, url: SITE_AUTHOR.url },
  ...(siteHref && {
    potentialAction: {
      "@type": "SearchAction",
      target: {
        "@type": "EntryPoint",
        urlTemplate: `${siteHref.replace(/\/$/, "")}/search/?q={search_term_string}`,
      },
      "query-input": "required name=search_term_string",
    },
  }),
};
---

<Layout
  title={SITE_NAME}
  description="A curated, Git-native library of structured prompts for sovereign AI workflows."
  canonicalPath="/"
  structuredData={structuredData}
>
  <section class="mb-12">
    <h1 class="text-3xl font-bold tracking-tight text-[var(--color-foreground)] sm:text-4xl">
      {SITE_NAME}
    </h1>
    <p class="mt-3 max-w-xl text-[0.98rem] sm:text-lg leading-relaxed text-[var(--color-muted)]">
      Plain-text prompts in Markdown, stored in Git. Easy to read, copy, and adapt in your own
      tools. No lock-in.
    </p>
    <p class="mt-6">
      <ButtonPrimary href={promptsIndex()}> Browse prompts </ButtonPrimary>
    </p>
  </section>

  {
    recentPrompts.length > 0 && (
      <section aria-labelledby="recent-heading" class="mt-10">
        <h2 id="recent-heading" class="mb-4 text-lg font-semibold text-[var(--color-foreground)]">
          Recent prompts
        </h2>
        <ul class="list-none space-y-3 p-0">
          {recentPrompts.map((entry) => (
            <li>
              <PromptCard entry={entry} />
            </li>
          ))}
        </ul>
        <p class="mt-4">
          <a
            href={promptsIndex()}
            class="text-sm text-[var(--color-accent)] no-underline hover:underline focus-visible:underline"
          >
            View all prompts â†’
          </a>
        </p>
      </section>
    )
  }
</Layout>
